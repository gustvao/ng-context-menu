angular.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menuElement:null}}).directive("contextMenu",["$document","ContextMenuService",function(e,n){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled"},link:function(t,l,u){function c(n,t){t.addClass("open");var l=e[0].documentElement,u=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),c=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=t[0].scrollWidth,a=t[0].scrollHeight,i=l.clientWidth+u,d=l.clientHeight+c,r=o+n.pageX,p=a+n.pageY,s=Math.max(n.pageX-u,0),f=Math.max(n.pageY-c,0);r>i&&(s-=r-i),p>d&&(f-=p-d),t.css("top",f+"px"),t.css("left",s+"px"),m=!0}function o(e){e.removeClass("open"),m=!1}function a(e){!t.disabled()&&m&&27===e.keyCode&&t.$apply(function(){o(n.menuElement)})}function i(e){var l=angular.element(e.target).hasClass(u.keepOpened);t.disabled()||!m||l||2===e.button&&e.target===n.element||t.$apply(function(){o(n.menuElement)})}var m=!1;l.bind("contextmenu",function(e){t.disabled()||(null!==n.menuElement&&o(n.menuElement),n.menuElement=angular.element(document.getElementById(u.target)),n.element=e.target,e.preventDefault(),e.stopPropagation(),t.$apply(function(){t.callback({$event:e}),c(e,n.menuElement)}))}),e.bind("keyup",a),e.bind("click",i),e.bind("contextmenu",i),t.$on("$destroy",function(){e.unbind("keyup",a),e.unbind("click",i),e.unbind("contextmenu",i)})}}}]);